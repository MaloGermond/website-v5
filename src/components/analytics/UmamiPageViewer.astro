---
// import { getUmamiConfig } from '@utils/umamiConfig';

const isEnabled = import.meta.env.UMAMI_ENABLED === "true"

if(!isEnabled) return ;

const {url:pageSlug=undefined, name:pageName=undefined} = Astro.props
// const config = getUmamiConfig();

const searchParams = new URLSearchParams(Astro.url.search);
const utmSource = searchParams.get('utm_source');
const utmMedium = searchParams.get('utm_medium');
const utmCampaign = searchParams.get('utm_campaign');
const utmTerm = searchParams.get('utm_term');
const utmContent = searchParams.get('utm_content');

const envMode = import.meta.env.DEV ? "development" : "production"


---

<script is:inline define:vars={{
    pageSlug: pageSlug,
    pageName: pageName,
    utmSource: utmSource,
    utmMedium: utmMedium,
    utmCampaign: utmCampaign,
    utmTerm: utmTerm,
    utmContent: utmContent,
    environement: envMode,
  }}>

  // Attendre que le script Umami soit chargÃ©
  document.addEventListener('DOMContentLoaded', () => {
    if (typeof umami !== 'undefined') {
    	umami.track('Environement', {environement});
      umami.track('View', {
        slug: pageSlug,
        name: pageName,
        utm_source: utmSource,
        utm_medium: utmMedium,
        utm_campaign: utmCampaign,
        utm_term: utmTerm,
        utm_content: utmContent,
      });
    }
  });
</script>


<script defer src="https://cloud.umami.is/script.js" data-website-id="90322f84-0c71-4989-a1b9-5514e2dac081"></script>
